<template>
  <nav class="h-auto md:flex-[0.2]">
    <SideBar
      @selectComponent="activeComponent = $event"
      @displayNotification="handleNotification"
      @showNav="handleShowNav"
    />
  </nav>

  <main
    v-if="!isMobile || (isMobile && sidebarHidden)"
    class="relative md:max-h-screen flex-1 md:w-full"
  >
    <Transition
      v-if="activeComponent === 'PresentationView'"
      enter-from-class="opacity-0"
      enter-active-class="transition ease-in duration-900"
      leave-to-class="opacity-0"
      leave-active-class="transition ease-in duration-700"
    >
      <component :is="componentsMap.PresentationView" />
    </Transition>

    <Transition
      v-else
      enter-from-class="translate-x-full opacity-0"
      enter-active-class="transition ease-in duration-1000"
      leave-to-class="translate-x-full opacity-0"
      leave-active-class="transition ease-in duration-700"
    >
      <component :is="componentsMap[activeComponent]" />
    </Transition>
  </main>

  <Transition
    enter-active-class="transform ease-out duration-300 transition"
    enter-from-class="translate-y-2 opacity-0 sm:translate-y-0 sm:translate-x-2"
    enter-to-class="translate-y-0 opacity-100 sm:translate-x-0"
    leave-active-class="transition ease-in duration-100"
    leave-from-class="opacity-100"
    leave-to-class="opacity-0"
  >
    <NotificationView
      v-if="notification.display"
      :message="notification.message"
      @closeNotification="handleNotification"
    />
  </Transition>
  <footer v-if="!isMobile"><FooterLayout /></footer>
</template>

<script setup>
  import { computed, defineAsyncComponent, provide, ref } from "vue";

  import GitHubActivity from "@/components/layouts/GithubActivity.vue";
  import SideBar from "@/components/navigation/SideBar.vue";
  import NotificationView from "@/components/commun/ui/NotificationTemplate.vue";
  import PresentationView from "@/components/layouts/PresentationView.vue";
  import FooterLayout from "@/components/commun/ui/FooterLayout.vue";

  import { getViewportDimensions } from "@/utils/toolsBox.js";
  // import { useSideBarToggle } from "@/utils/composables/useSidebarToggle";
  // const { showNavigation } = useSideBarToggle();

  /*****************************************
   *            Imports dynamiques            *
   ******************************************/

  const ColorfulRods = defineAsyncComponent(() =>
    import("@/components/layouts/ColorfulRods.vue")
  );

  const ElusiveView = defineAsyncComponent(() =>
    import("@/components/layouts/ElusiveView.vue")
  );

  const MondrianFrames = defineAsyncComponent(() =>
    import("@/components/layouts/MondrianFrames.vue")
  );

  const ConferenceGallery = defineAsyncComponent(() =>
    import("@/components/layouts/ConferenceGallery.vue")
  );

  /*****************************************
   *      Activation des composants          *
   ******************************************/

  const activeComponent = ref("PresentationView");

  provide("activeComponentKey", activeComponent);

  const componentsMap = {
    PresentationView,
    ColorfulRods,
    GitHubActivity,
    ElusiveView,
    MondrianFrames,
    ConferenceGallery,
  };

  /*****************************************
   *              Notification              *
   ******************************************/

  const notification = ref({ display: false, message: "" });

  const handleNotification = (payload) => {
    notification.value = payload;
    if (!notification.value.display) return;

    setTimeout(() => {
      notification.value.display = false;
      notification.value.message = "";
    }, 9000);
  };

  /*****************************************
   *         Mobile Viewport + Toggle        *
   ******************************************/

  const isMobile = computed(() => getViewportDimensions().viewportWidth < 768);

  const sidebarHidden = ref(false);

  const handleShowNav = (newValue) => {
    sidebarHidden.value = !newValue;
    console.log("ðŸš€ ~ handleShowNav ~ showNavigation:", sidebarHidden.value);
  };
</script>
